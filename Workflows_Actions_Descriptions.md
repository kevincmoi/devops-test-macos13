# Description of workflows and actions

**"Recette build IOS App" workflow**

The "Recette build IOS App" workflow is triggered by pushing a tag in the format "v*..-recette" from the develop branch. It executes unit tests and builds the application by calling the wc_test and wc_build workflows respectively, and generates a pre-release.

The main steps of "Recette build IOS App" workflow are:
- Variables:
    - Retrieve the source code from the repository.
    - Select the specified version of Xcode and stop the workflow if the selected Xcode version is different from the specified version.
    - Check the macOS version (simply displayed in the logs).
    - Set the selected Xcode version in $GITHUB_OUTPUT and stop the workflow if the selected Xcode version is different from the specified version.
    - Define variables in $GITHUB_OUTPUT: configuration_build (used in wc_build), xcodeversion (used in wc_test and wc_build).

- Localization:
    - Display "curl localization files" in the logs.

- Test and Build: Execute the wc_test workflow, followed by the wc_build workflow, providing them with the required variables.

- Release:
    - Execute only if Build is successful and it is a Git tag.
    - Retrieve the artifact generated by Build.
    - Create a release (prerelease-version) on GitHub, including the IPA files (required for iOS application distribution) and dSYM files (debugging).

<br>

**"wc_test" workflow**

The "wc_test" workflow is a reusable workflow called by the "Recette build IOS App" workflow. This workflow enables the execution of unit tests with Xcode.

The main steps of "wc_test" are:
- Retrieve the source code from the repository.
- Configure Xcode with the specified version.
- Execute the tests.

<br>

**"wc_build" workflow**

The "wc_build" workflow is a reusable workflow called by the "Recette build IOS App" workflow.
This workflow uses two actions, "apple-certificate/action" and "apple-provisionning/action", to import a P12 certificate and provide an Apple provisioning profile (essential for iOS application development and deployment).

The main steps of "wc_build" are:
- Retrieve the source code from the repository.
- Update the application version (via agvtool).
- Install an Apple provisioning profile (via the apple-provisioning action) required for building the application.
- Install an Apple P12 certificate (via the apple-certificate action) required for building the application.
- Compile and generate an archive (via Xcode).
- Upload the archive as a GitHub artifact.

<br>

**"run-create-release-from-artifact" workflow**

The "run-create-release-from-artifact" workflow is triggered manually (with the branch and artifact name as inputs) to generate a GitHub release from the artifact generated by the "Recette" workflow.

The main steps of the "run-create-release-from-artifact" workflow are:
- Retrieve the source code from the repository.
- Retrieve the artifact.
- Create a release name based on the version present in the artifact name (release-version).
- Create and push a TAG (release name) to GitHub.
- Compress the dSYM file.
- Display the list of files in the directory.
- Create the release, including the compressed dSYM file and the IPA file.

<br>

**"develop-schedule-build-dev" workflow**

The "develop-schedule-build-dev" workflow is automatically triggered every 2 hours between 8 AM and 6 PM. It checks the latest commit pushed to the develop branch, and if that commit is less than two hours old, the workflow will display "scheduled activated".

<br>

**"apple-certificat" action**

The "apple-certificate" action allows the import of a P12 certificate, which provides the necessary credentials to sign and authenticate iOS applications during the build process.

The main steps of the "apple-certificate" action are:

- Decode the P12 file (encoded in base64) and place it in the specified file path.
- Create a keychain with a specified password and file path, and configure its settings (used to store and manage sensitive security-related information).
- Unlock the keychain.
- Display the list of files present in the runner's temporary directory.
- Display the list of keychains present in the KEYCHAIN_PATH.

<br>

**"apple-provisionning" action**

The "apple-provisioning" action allows the installation of an Apple provisioning profile that contains specific application-specific credentials, enabling the signing and authorization of the iOS application during the build process.

The main steps of the "apple-provisioning" action are:

- Decode the provisioning file (encoded in base64) and place it in the runner's temporary directory.
- Create a directory and copy the file to this new directory.